[README.md](https://github.com/user-attachments/files/23413367/README.md)
# 在宅医療カルテ - 音声入力システム

在宅医療の現場で、音声入力によりカルテ記録を効率的に作成できるWebアプリケーションです。

## 🎯 プロジェクト概要

訪問診療や在宅医療の現場で、医療従事者が手を使わずに音声でカルテ記録を入力できるシステムです。シンプルで直感的なUIにより、最小限の操作で記録業務を完了できます。

**NEW!** テンプレート機能とクロスログ連携機能を追加しました。

## ✨ 主な機能

### 実装済み機能

#### 1. **音声入力機能**
- Web Speech APIを使用したリアルタイム音声認識
- 連続音声入力に対応（話し続けても自動的に認識を継続）
- 日本語音声認識に最適化
- 録音中は視覚的なフィードバック（アニメーション）を表示

#### 2. **シンプルなUI**
- 中央に配置された大きな紫グラデーションの円形マイクボタン
- タップ/クリック1回で音声入力を開始
- リアルタイムで音声認識テキストを表示
- ミニマルなデザインで操作に迷わない

#### 3. **テンプレート機能** ⭐NEW
- カルテテンプレートの登録・管理
- タイトルと文章（本文）でテンプレートを作成
- テンプレート選択により音声入力内容を自動整形
- 3つのサンプルテンプレート付属：
  - 基本的な訪問記録
  - 訪問看護記録
  - 簡易記録
- テンプレート内で変数使用可能（例：`{visit_date}`, `{vital_signs}`）
- テンプレートの編集・削除機能

#### 4. **クロスログ連携機能** ⭐NEW
- URLパラメータによる患者情報の自動読み込み
- クロスログからの遷移に対応
- 患者のクロスログIDを保存
- カルテ作成後、クロスログへの自動遷移オプション

#### 5. **音声コマンド**
最小限の手入力で操作できるよう、音声コマンドに対応：
- 「保存」「ほぞん」→ カルテ記録を保存
- 「クリア」「くりあ」「キャンセル」「きゃんせる」→ 入力内容をクリア
- 「患者〇〇」→ 患者を音声で選択

#### 6. **患者管理**
- 患者一覧の表示
- ドロップダウンで簡単に患者選択
- 患者情報の表示（氏名、生年月日、住所、電話番号、クロスログID）
- URLパラメータからの自動患者登録

#### 7. **カルテ記録の保存・管理**
- RESTful Table APIを使用したデータ永続化
- 訪問日時の自動記録
- 音声入力テキストの保存
- テンプレート使用時は整形済みカルテを保存

#### 8. **履歴閲覧機能**
- 過去のカルテ記録を一覧表示
- 患者別の記録確認
- 記録の削除機能

## 🔗 クロスログ連携の使い方

### クロスログからこのアプリへの遷移

クロスログの「チャット・URL連携」機能で、このアプリのURLを以下の形式で設定：

```
https://your-app-url.com/?patient_name=山田太郎&crosslog_id=12345&return_url=https://app.crosslog.life/calendar/weekly/
```

**URLパラメータ:**
- `patient_name` - 患者氏名（必須）
- `crosslog_id` - クロスログの患者ID（任意）
- `patient_id` - このアプリ内の患者ID（任意）
- `return_url` - クロスログへの戻りURL（任意）

### 動作フロー

1. クロスログでURL連携ボタンをクリック
2. このアプリが開き、患者情報を自動読み込み
3. 音声入力でカルテを作成
4. 「カルテを作成」ボタンで保存
5. 確認ダイアログでクロスログに戻る

## 📝 テンプレートの使い方

### テンプレートの作成

1. 画面右上の「テンプレート」ボタンをクリック
2. 新規テンプレート登録フォームに入力
   - **タイトル**: テンプレート名（例：基本的な訪問記録）
   - **文章**: カルテの構造（例：【訪問日時】{visit_date}）
3. 「テンプレートを保存」をクリック

### テンプレート内の変数

以下の変数をテンプレートで使用できます：

| 変数名 | 説明 | 自動入力 |
|--------|------|---------|
| `{visit_date}` | 訪問日時 | ✅ 現在時刻 |
| `{content}` | 音声入力内容 | ✅ 全文 |
| `{voice_input}` | 音声入力内容 | ✅ 全文 |
| `{chief_complaint}` | 主訴 | 🔄 音声より抽出 |
| `{vital_signs}` | バイタルサイン | 🔄 音声より抽出 |
| `{treatment}` | 処置内容 | 🔄 音声より抽出 |
| その他 | カスタム変数 | 🔄 音声より抽出 |

※ 現在は音声入力内容がそのまま挿入されます。将来的にAIによる自動抽出を実装予定。

### サンプルテンプレート

```
【訪問日時】
{visit_date}

【主訴】
{chief_complaint}

【バイタルサイン】
血圧：{blood_pressure}
体温：{temperature}
脈拍：{pulse}

【処置・治療】
{treatment}

【特記事項】
{notes}
```

## 🗂 データベース構造

### `patients` テーブル（患者情報）
| フィールド | 型 | 説明 |
|----------|-----|------|
| id | text | 患者ID（主キー） |
| name | text | 患者氏名 |
| name_kana | text | 患者氏名（カナ） |
| birth_date | text | 生年月日 |
| address | text | 住所 |
| phone | text | 電話番号 |
| **crosslog_id** ⭐NEW | text | クロスログ患者ID |

### `medical_records` テーブル（カルテ記録）
| フィールド | 型 | 説明 |
|----------|-----|------|
| id | text | 記録ID（主キー） |
| patient_id | text | 患者ID |
| patient_name | text | 患者氏名 |
| visit_date | datetime | 訪問日時 |
| voice_text | rich_text | 音声入力テキスト（整形済み） |
| symptoms | rich_text | 症状・主訴 |
| vital_signs | text | バイタルサイン |
| treatment | rich_text | 処置・治療内容 |
| notes | rich_text | 特記事項 |

### `templates` テーブル（テンプレート） ⭐NEW
| フィールド | 型 | 説明 |
|----------|-----|------|
| id | text | テンプレートID（主キー） |
| title | text | テンプレートタイトル |
| content | rich_text | テンプレート本文 |

## 🚀 使用方法

### 基本的な操作フロー

1. **アプリを開く**
   - ブラウザでindex.htmlにアクセス
   - またはクロスログから遷移

2. **患者を選択**
   - 画面上部のドロップダウンから訪問患者を選択
   - または音声で「患者〇〇さん」と発話
   - クロスログからの遷移時は自動選択

3. **テンプレートを選択（任意）**
   - カルテテンプレートのドロップダウンから選択
   - 選択しない場合は通常の音声入力

4. **音声入力を開始**
   - 中央の紫色の円形マイクボタンをタップ/クリック
   - マイクへのアクセス許可が求められたら「許可」を選択

5. **カルテ内容を話す**
   - 音声でカルテ内容を入力
   - リアルタイムでテキスト化されて表示
   - 録音中はボタンが赤色に変化しアニメーション表示

6. **カルテを作成**
   - 「カルテを作成」ボタンをクリック
   - または音声で「保存」と発話
   - テンプレート選択時は自動整形されて保存
   - クロスログからの遷移時は戻り確認ダイアログ表示

7. **履歴を確認**
   - 右上の「履歴」ボタンをクリック
   - 過去の記録を確認・削除できる

### テンプレート管理

1. 右上の「テンプレート」ボタンをクリック
2. 新規登録フォームにタイトルと文章を入力
3. 「テンプレートを保存」をクリック
4. 登録済みテンプレート一覧で確認・削除

### 音声コマンド一覧

| コマンド | 動作 |
|---------|------|
| 「保存」「ほぞん」 | カルテ記録を保存 |
| 「クリア」「くりあ」 | 入力内容をクリア |
| 「キャンセル」「きゃんせる」 | 入力内容をクリア |
| 「患者〇〇」 | 患者を選択 |

## 🛠 技術スタック

- **HTML5** - セマンティックなマークアップ
- **Tailwind CSS** - ミニマルで美しいUIデザイン（CDN版）
- **Font Awesome** - アイコン表示
- **Vanilla JavaScript** - フレームワークレスの軽量実装
- **Web Speech API** - ブラウザ組み込みの音声認識
- **RESTful Table API** - データの永続化

## 📁 プロジェクト構造

```
.
├── index.html          # メインHTMLファイル
├── css/
│   └── style.css       # カスタムCSS（ボタンアニメーション等）
├── js/
│   └── app.js          # メインJavaScriptファイル
└── README.md           # このファイル
```

## 🎨 UIデザインの特徴

### 紫グラデーションの円形マイクボタン
- 直径200px（モバイルは160px）の大きな円形ボタン
- 外側：回転する紫色のグラデーションリング
- 中央：紫グラデーションの背景にマイクアイコン
- 録音中：赤色に変化し、脈打つアニメーション
- 波紋エフェクトで録音状態を視覚的に表現

### レスポンシブデザイン
- PC、タブレット、スマートフォンに対応
- タッチ操作にも最適化

## 🔧 カスタマイズ・拡張

### ATOK医療辞書との連携
音声入力後の手動編集時に、ユーザーのPC環境にインストールされたATOK（医療辞書付き）を活用できます。音声認識で大まかな内容を入力し、ATOKの医療用語変換で精度を高める運用が可能です。

### 今後の拡張可能性
- **AI自動抽出機能** - 音声入力からバイタルや症状を自動抽出
- **医療用語の自動補完** - よく使う医療用語の候補表示
- **バイタルサイン入力の専用UI** - 数値入力フォーム
- **PDF出力機能** - カルテのPDF化
- **印刷最適化** - 印刷用レイアウト
- **クロスログAPI連携** - 双方向データ同期（APIキー取得後）

## ⚠️ ブラウザ対応

### 対応ブラウザ
- Google Chrome（推奨）
- Microsoft Edge
- Safari（一部制限あり）

### 非対応ブラウザ
- Firefox（Web Speech APIの対応が限定的）
- Internet Explorer（未対応）

**注意**: Web Speech APIはChrome/Edgeで最も安定して動作します。

## 🔒 プライバシーとセキュリティ

- 音声データはブラウザ内でGoogle音声認識APIに送信されます
- 医療情報の取り扱いには十分注意してください
- 本番環境では適切なセキュリティ対策（HTTPS、認証など）が必要です
- クロスログとの連携はURLパラメータのみ（APIキー不要）

## 📋 RESTful API エンドポイント

### 患者情報API
```
GET  /tables/patients              # 患者一覧取得
GET  /tables/patients/{id}         # 患者詳細取得
POST /tables/patients              # 患者新規登録
```

### カルテ記録API
```
GET    /tables/medical_records           # 記録一覧取得
GET    /tables/medical_records/{id}      # 記録詳細取得
POST   /tables/medical_records           # 記録新規作成
DELETE /tables/medical_records/{id}      # 記録削除
```

### テンプレートAPI ⭐NEW
```
GET    /tables/templates           # テンプレート一覧取得
GET    /tables/templates/{id}      # テンプレート詳細取得
POST   /tables/templates           # テンプレート新規作成
DELETE /tables/templates/{id}      # テンプレート削除
```

## 📝 今後の実装予定

### 未実装機能
- 患者新規登録UI（フォーム）
- カルテ記録の編集機能
- AI自動抽出（バイタル、症状、処置など）
- 医療用語辞書機能
- エクスポート機能（CSV、PDF）
- 音声入力の一時停止機能
- 複数医療従事者の管理
- クロスログAPI統合（APIキー取得後）

### 推奨される次のステップ
1. **AI自動抽出機能** - 音声入力からカルテ項目を自動分類
2. **患者登録フォーム** - 新規患者をアプリ内から追加
3. **医療用語補完** - よく使う医療用語の候補表示
4. **バイタル専用入力** - 数値入力に特化したUI
5. **認証機能** - ユーザーログイン・権限管理

## 🌐 デプロイ

Webアプリをインターネット上に公開するには、画面上部の **Publishタブ** をクリックしてください。
ワンクリックでデプロイが完了し、公開URLが発行されます。

公開後、そのURLをクロスログの「チャット・URL連携」に登録することで、クロスログからの遷移が可能になります。

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 🤝 貢献

バグ報告や機能リクエストは、プロジェクトのIssueにて受け付けています。

---

**開発日**: 2025年11月2日  
**バージョン**: 2.0.0  
**最終更新**: 2025年11月2日  
**開発環境**: Static Website Builder

### 更新履歴

**v2.0.0 (2025-11-02)**
- ✨ テンプレート機能追加
- ✨ クロスログ連携機能追加
- ✨ URLパラメータによる患者自動読み込み
- 🔄 「カルテを保存」→「カルテを作成」に変更
- 🗄️ templatesテーブル追加
- 🗄️ patientsテーブルにcrosslog_idフィールド追加

**v1.0.0 (2025-11-02)**
- 🎉 初回リリース
- 音声入力機能
- 患者管理機能
- カルテ記録保存
